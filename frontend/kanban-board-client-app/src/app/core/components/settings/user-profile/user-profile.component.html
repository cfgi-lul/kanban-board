<div class="profile">
  <div class="profile__header">
    <div class="profile__header-content">
      <div class="profile__title">
        {{ 'settings.profileInformation' | translate }}
      </div>
      <div class="profile__subtitle">
        {{ 'settings.manageAccountDetails' | translate }}
      </div>
    </div>
  </div>
  <mat-divider class="profile__divider" />
  @if (isLoading) {
    <div class="profile__loading">
      <mat-spinner diameter="40" />
      <div>{{ 'settings.loadingProfile' | translate }}</div>
    </div>
  } @else {
    <div [formGroup]="profileForm" class="profile__form">
      <kn-avatar-picker
        [avatarUrl]="getAvatarUrl()"
        [hasAvatar]="!!currentUser?.avatar"
        [isUploading]="isUploadingAvatar"
        (fileSelected)="onFileSelected($event)"
        (removeAvatar)="removeAvatar()"
      />

      <mat-form-field appearance="outline" class="profile__field">
        <mat-label>{{ 'settings.username' | translate }}</mat-label>
        <input matInput [value]="currentUser?.username" readonly />
        <mat-icon matSuffix>lock</mat-icon>
        <mat-hint>{{ 'settings.usernameReadOnly' | translate }}</mat-hint>
      </mat-form-field>

      <mat-form-field appearance="outline" class="profile__field">
        <mat-label>{{ 'settings.displayName' | translate }}</mat-label>
        <input
          matInput
          formControlName="displayName"
          placeholder="{{ 'settings.displayNamePlaceholder' | translate }}"
        />
        @if (profileForm.get('displayName')?.hasError('required')) {
          <mat-error>
            {{ getErrorMessage('displayName') | translate }}
          </mat-error>
        }
        @if (profileForm.get('displayName')?.hasError('minlength')) {
          <mat-error>
            {{ getErrorMessage('displayName') | translate }}
          </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="profile__field">
        <mat-label>{{ 'settings.email' | translate }}</mat-label>
        <input
          matInput
          formControlName="email"
          type="email"
          placeholder="{{ 'settings.emailPlaceholder' | translate }}"
        />
        @if (profileForm.get('email')?.hasError('required')) {
          <mat-error>
            {{ getErrorMessage('email') | translate }}
          </mat-error>
        }
        @if (profileForm.get('email')?.hasError('email')) {
          <mat-error>
            {{ 'settings.invalidEmail' | translate }}
          </mat-error>
        }
      </mat-form-field>

      <kn-account-info [currentUser]="currentUser" />

      <div class="profile__actions">
        <button
          mat-raised-button
          color="primary"
          (click)="onSubmit()"
          [disabled]="profileForm.invalid || isSaving"
          class="profile__submit"
        >
          @if (isSaving) {
            <mat-spinner diameter="20" class="profile__submit-spinner" />
            <span>{{ 'settings.saving' | translate }}</span>
          } @else {
            <span>{{ 'settings.saveChanges' | translate }}</span>
          }
        </button>
      </div>
    </div>
  }
</div>
